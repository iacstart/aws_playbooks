---
- hosts: localhost
  connection: local
  gather_facts: False

  tasks:
  - name: Provision a set of instances
    ec2:
      region: "{{ region }}"
      key_name: "{{ ssh_key }}"
      group_id: "{{ security_group_id }}"
      vpc_subnet_id: "{{ vpc_subnet_id }}"
      instance_type: t2.micro
      image: "{{ ami_id }}"
      wait: true
      instance_tags:
        Name: iacstart_webserver
      #exact_count: "{{ instcount }}"
      #count_tag: 
        #Name: towerdemo
    register: ec2

  - name: Wait for SSH to come up
  wait_for:
    host: "{{ item.public_ip }}"
    port: 22 
    state: started 
  with_items: "{{ ec2.instances }}"
